<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: server.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: server.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const express = require("express");
const cors = require("cors");
const login = require("./login.js");
const immobles = require("./immobles.js");
const usuaris = require("./usuaris.js");
const logout = require("./logout.js");
const calculaHipoteca = require("./simuladorHipoteca.js");
const favoritsImmobles = require('./favoritsImmobles.js');
const cookieParser = require('cookie-parser');
const https = require('https');
const fs = require('fs');
const dotenv = require("dotenv");
const http = require('http');
dotenv.config();

/**
 * Express app per al servidor.
 * @type {object}
 */
const app = express();

const corsOptions = JSON.parse(process.env.CORS_OPTIONS);

// Utilitzar la configuració CORS especificada
app.use(cors(corsOptions));

// Middleware per a interpretar cookies
app.use(cookieParser());

// Rutes per als diferents endpoints
app.use('/', login);
app.use('/', immobles);
app.use('/', usuaris);
app.use('/', logout);
app.use('/', calculaHipoteca);
app.use('/', favoritsImmobles);

// Opcions del servidor HTTPS
let SSLoptions = {};

// Comprovar si l'aplicació està en entorn de producció
if (process.env.ENVIRONMENT === 'live') {
    SSLoptions = {
        key: fs.readFileSync('../../etc/letsencrypt/live/solaria.website/privkey.pem'),
        cert: fs.readFileSync('../../etc/letsencrypt/live/solaria.website/fullchain.pem'),
    };
}

// Crear servidor HTTP o HTTPS segons l'entorn
let server;
if (require.main === module) {
    const PORT = process.env.PORT || 3333;
    if (process.env.ENVIRONMENT === 'live') {
        server = https.createServer(SSLoptions, app);
    } else {
        server = http.createServer(app);
    }
    server.listen(PORT, () => {
        console.log(`Servidor funcionant al PORT: ${PORT}`);
    });
}

module.exports = app;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#ERROR_ACCES_PROHIBIT">ERROR_ACCES_PROHIBIT</a></li><li><a href="global.html#app">app</a></li><li><a href="global.html#crearObjectesMock">crearObjectesMock</a></li><li><a href="global.html#db">db</a></li><li><a href="global.html#express">express</a></li><li><a href="global.html#login">login</a></li><li><a href="global.html#logout">logout</a></li><li><a href="global.html#paginateResults">paginateResults</a></li><li><a href="global.html#refrescarToken">refrescarToken</a></li><li><a href="global.html#verificaExisteixImmoble">verificaExisteixImmoble</a></li><li><a href="global.html#verificaToken">verificaToken</a></li><li><a href="global.html#verificarTipusUsuari">verificarTipusUsuari</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.3</a> on Sun May 05 2024 21:09:49 GMT+0200 (Central European Summer Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
